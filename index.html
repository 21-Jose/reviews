<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>¿Qué opina la gente de José?</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 0;
      padding: 0;
      background: #f5f5f5;
    }
    h1 {
      text-align: center;
      padding: 1rem;
      background-color: #ffffff;
      margin: 0;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    .controls {
      padding: 1rem;
      background: #fff;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      align-items: center;
      justify-content: center;
    }
    .controls input,
    .controls select,
    .controls button {
      padding: 0.5rem;
      font-size: 1rem;
      flex: 1 1 200px;
      min-width: 150px;
    }
    .container {
      max-width: 600px;
      margin: 1rem auto;
      padding: 0 1rem;
    }
    .comment {
      background: white;
      border-radius: 8px;
      padding: 1rem;
      margin-bottom: 1rem;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      opacity: 0;
      transform: translateY(10px);
      transition: opacity 0.8s ease, transform 0.8s ease;
      position: relative;
    }
    .comment.show {
      opacity: 1;
      transform: translateY(0);
    }
    .stars {
      color: gold;
      font-size: 1.2rem;
      margin-bottom: 0.5rem;
    }
    .username {
      font-weight: bold;
      margin-bottom: 0.25rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .username.hidden-name .name-text {
      display: none;
    }
    .username.visible-name .reveal-name-btn {
      display: none;
    }
    .reveal-name-btn {
      background: transparent;
      border: none;
      font-size: 1.2rem;
      cursor: pointer;
      padding: 0;
    }
    .text {
      color: #333;
    }
    .translate-btn {
      margin-top: 0.5rem;
      font-size: 0.9rem;
      padding: 0.3rem 0.5rem;
      background: #e0e0e0;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    .translate-btn:hover {
      background: #d0d0d0;
    }
    .translated-text {
      display: none;
      margin-top: 0.5rem;
      color: #555;
      opacity: 0;
      transition: opacity 0.4s ease;
    }
    .translated-text.show {
      display: block;
      opacity: 1;
    }
    .hidden {
      display: none !important;
    }
  </style>
</head>
<body>

  <h1>¿Qué opina la gente de José?</h1>

  <div class="controls">
    <input id="search-input" type="text" placeholder="Buscar comentarios..." />
    <select id="sort-select">
      <option value="original">Orden original</option>
      <option value="desc">Ordenar por valoración: alta → baja</option>
      <option value="asc">Ordenar por valoración: baja → alta</option>
    </select>
    <button id="toggle-names-btn">Mostrar nombres de usuarios</button>
  </div>

  <div class="container" id="comments-container"></div>

  <script>
    const allComments = [
      { user: "Ana", rating: 5, text: "Excelente servicio, ¡muy recomendado!" },
      { user: "Luis", rating: 4, text: "Todo bien, pero hay cosas que mejorar." },
      { user: "Marta", rating: 3, text: "Cumple su función, sin destacar." },
      { user: "Carlos", rating: 2, text: "No fue lo que esperaba." },
      { user: "Sofía", rating: 1, text: "Una experiencia terrible." },
      { user: "El rayo maqueen", rating: 5, text: "¡Ka-chow!" },
      { user: "Pedro", rating: 5, text: "Me encantó, repetiría sin dudarlo." },
      { user: "Lucía", rating: 4, text: "Muy buena atención y calidad." },
      { user: "Jorge", rating: 3, text: "Normal, no me sorprendió." },
      { user: "Raquel", rating: 2, text: "Podría mejorar bastante." },
      { user: "Miguel", rating: 1, text: "No lo recomiendo para nada." },
      { user: "Esteban", rating: 5, text: "Fantástico desde el principio." },
      { user: "Natalia", rating: 4, text: "Buena experiencia en general." },
      { user: "Iván", rating: 3, text: "Está bien, sin más." },
      { user: "Andrea", rating: 2, text: "Demasiado lento el servicio." },
      { user: "Tomás", rating: 1, text: "No volveré a usarlo." },
      {
        user: "Phil Spencer",
        rating: 5,
        text: "Hope you all enjoyed our latest Xbox Showcase — it means a lot to see the incredible energy from the community every year. Your passion, feedback, and support continue to inspire the entire team. Thanks for being on this journey with us. We’re just getting started.",
        translated: "Mondongo"
      }
    ];

    let filteredComments = [...allComments];
    let currentIndex = 0;

    function renderStars(rating, isRayo = false) {
      const symbol = isRayo ? '⚡' : '★';
      const empty = isRayo ? '⚡' : '☆';
      return symbol.repeat(rating) + empty.repeat(5 - rating);
    }

    function loadMoreComments(count = 1) {
      const container = document.getElementById('comments-container');
      for (let i = 0; i < count && currentIndex < filteredComments.length; i++) {
        const { user, rating, text, translated } = filteredComments[currentIndex++];
        const isRayo = user.toLowerCase().includes("rayo");
        const div = document.createElement('div');
        div.className = 'comment';
        div.innerHTML = `
          <div class="stars">${renderStars(rating, isRayo)}</div>
          <div class="username hidden-name">
            <button class="reveal-name-btn" title="Mostrar nombre">❔</button>
            <span class="name-text">${user}</span>
          </div>
          <div class="text">${text}</div>
          ${translated ? `
            <button class="translate-btn">Mostrar traducción</button>
            <div class="translated-text">${translated}</div>
          ` : ''}
        `;
        container.appendChild(div);
        requestAnimationFrame(() => div.classList.add('show'));
      }
    }

    function loadUntilFilled() {
      const startHeight = document.body.scrollHeight;
      loadMoreComments(1);
      const afterLoadHeight = document.body.scrollHeight;
      if (afterLoadHeight < window.innerHeight && currentIndex < filteredComments.length) {
        requestAnimationFrame(loadUntilFilled);
      }
    }

    function applyFilters() {
      const search = document.getElementById('search-input').value.toLowerCase();
      const sort = document.getElementById('sort-select').value;

      filteredComments = allComments
        .filter(c => c.text.toLowerCase().includes(search));

      if (sort === 'asc') {
        filteredComments.sort((a, b) => a.rating - b.rating);
      } else if (sort === 'desc') {
        filteredComments.sort((a, b) => b.rating - a.rating);
      } 
      // if 'original', no sort applied, keep original order

      currentIndex = 0;
      const container = document.getElementById('comments-container');
      container.innerHTML = '';
      loadUntilFilled();
    }

    window.addEventListener('scroll', () => {
      if (window.innerHeight + window.scrollY >= document.body.offsetHeight - 100) {
        loadMoreComments(1);
      }
    });

    document.addEventListener('DOMContentLoaded', () => {
      applyFilters();

      document.getElementById('search-input').addEventListener('input', applyFilters);
      document.getElementById('sort-select').addEventListener('change', applyFilters);

      const toggleNamesBtn = document.getElementById('toggle-names-btn');
      let namesVisible = false;

      toggleNamesBtn.addEventListener('click', () => {
        const usernames = document.querySelectorAll('.username');
        usernames.forEach(u => {
          u.classList.toggle('visible-name', !namesVisible);
          u.classList.toggle('hidden-name', namesVisible);
        });
        namesVisible = !namesVisible;
        toggleNamesBtn.textContent = namesVisible
          ? "Ocultar nombres de usuarios"
          : "Mostrar nombres de usuarios";
      });

      const container = document.getElementById('comments-container');
      container.addEventListener('click', (e) => {
        if (e.target.classList.contains("translate-btn")) {
          e.stopPropagation();
          const btn = e.target;
          const txt = btn.nextElementSibling;
          const isVisible = txt.classList.contains('show');
          txt.classList.toggle('show');
          btn.textContent = isVisible ? "Mostrar traducción" : "Ocultar traducción";
        }

        if (e.target.classList.contains("reveal-name-btn")) {
          e.stopPropagation();
          const comment = e.target.closest('.comment');
          const nameEl = comment.querySelector(".username");
          nameEl.classList.remove('hidden-name');
          nameEl.classList.add('visible-name');
        }
      });
    });
  </script>
</body>
</html>
